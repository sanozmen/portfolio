<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<title>Coronavirus Map </title>
<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-57534785-2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-57534785-2');
  </script>
<script src='https://api.mapbox.com/mapbox.js/v3.2.1/mapbox.js'></script>
<link href='https://api.mapbox.com/mapbox.js/v3.2.1/mapbox.css' rel='stylesheet' />
 <!-- marker cluster styles-->
 <link rel="stylesheet" type="text/css" href="https://unpkg.com/leaflet.markercluster@1.0.4/dist/MarkerCluster.Default.css">
 <link rel="stylesheet" type="text/css" href="https://unpkg.com/leaflet.markercluster@1.0.4/dist/MarkerCluster.css">
<script src="https://unpkg.com/leaflet.markercluster@1.0.4/dist/leaflet.markercluster.js"></script>
<style>
  body { margin:0; padding:0; }
  #map { position:absolute; top:0; bottom:0; width:100%; }
  .leaflet-tooltip-pane .text {
  color:black; 
  /*-webkit-text-stroke: 0.03em white;*/
  font-weight: bold;
  background: transparent;
  border:0;
  box-shadow: none;
  font-size: 1em;
}
</style>
</head>
<body>
<script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.2.0/leaflet-omnivore.min.js'></script>

<div id='map'></div>
<script src="https://unpkg.com/leaflet.markercluster@1.0.4/dist/leaflet.markercluster.js"></script>
<script
  src="https://code.jquery.com/jquery-3.4.1.js"
  integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
  crossorigin="anonymous"></script>
 <!-- for titling the layer groups-->
 <script src="https://rawgithub.com/ismyrnow/Leaflet.groupedlayercontrol/master/src/leaflet.groupedlayercontrol.js"></script>
<script>

var grayscale = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
  attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
  subdomains: 'abcd',
  maxZoom: 19
});
var CartoDB_DarkMatter = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
	attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
	subdomains: 'abcd',
	maxZoom: 19
});

var Stadia_AlidadeSmoothDark = L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/{z}/{x}/{y}{r}.png', {
	maxZoom: 20,
	attribution: '&copy; <a href="https://stadiamaps.com/">Stadia Maps</a>, &copy; <a href="https://openmaptiles.org/">OpenMapTiles</a> &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'
});
var CartoDB_Voyager = L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
	attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
	subdomains: 'abcd',
	maxZoom: 19
});
var map = L.map('map', {
          zoom: 3,
          center: [39.92,32.85],
          layers: [grayscale]

        });
/*L.mapbox.accessToken = 'pk.eyJ1Ijoic2Fub3ptZW4iLCJhIjoib2xwbVQtQSJ9.1ldcOvJz39J-WFX89QdO_Q';
var map = L.mapbox.map('map')
  .setView([38, -95], 4)
  .addLayer(L.mapbox.styleLayer('mapbox://styles/mapbox/streets-v11'));*/

// Omnivore will AJAX-request this file behind the scenes and parse it:
// note that there are considerations:
// - The CSV file must contain latitude and longitude values, in column
//   named roughly latitude and longitude
// - The file must either be on the same domain as the page that requests it,
//   or both the server it is requested from and the user's browser must
//   support CORS.

var small_icon = {
    radius: 6,
    fillColor: "#fecc5c",
    color: "#000",
    weight: 0.2,
    opacity: 1,
    fillOpacity: 0.8
};


var medium_icon = {
    radius: 10,
    fillColor: "#fd8d3c",
    color: "#000",
    weight: 0.2,
    opacity: 1,
    fillOpacity: 0.8
};

var large_icon = {
    radius: 13,
    fillColor: "#e31a1c",
    color: "#000",
    weight: 0.2,
    opacity: 1,
    fillOpacity: 0.8
};

var small_icon_r = {
    radius: 6,
    fillColor: "#a1d99b",
    color: "000",
    weight: 0.2,
    opacity: 1,
    fillOpacity: 0.8
};


var medium_icon_r = {
    radius: 10,
    fillColor: "#7bccc4",
    color: "#000",
    weight: 0.2,
    opacity: 1,
    fillOpacity: 0.8
};

var large_icon_r = {
    radius: 13,
    fillColor: "#2b8cbe",
    color: "#000",
    weight: 0.2,
    opacity: 1,
    fillOpacity: 0.8
};

var d = new Date();
year=d.getFullYear();
year=year-2000
month=d.getMonth();
month=month+1
day=d.getDate()
yesterday=day-1
if (day==1 && month==1){
    yesterday=31
    month=12
}
else if (day==1 && month==2){
    yesterday=31
    month=1
}
else if (day==1 && month==3){
    yesterday=29
    month=2
}
else if (day==1 && month==4){
    yesterday=31
    month=3
}
else if (day==1 && month==5){
    yesterday=30
    month=4
}
else if (day==1 && month==6){
    yesterday=31
    month=5
}
else if (day==1 && month==7){
    yesterday=30
    month=6
}
else if (day==1 && month==8){
    yesterday=31
    month=7
}
else if (day==1 && month==9){
    yesterday=31
    month=8
}
else if (day==1 && month==10){
    yesterday=30
    month=9
}
else if (day==1 && month==11){
    yesterday=31
    month=10
}
else if (day==1 && month==12){
    yesterday=30
    month=11
}

var todayString=month+"/"+day+"/"+year
var yesterdayString=month+"/"+yesterday+"/"+year
console.log(todayString)


var country="Country/Region"


var customLayer = L.geoJson(null, {
    filter: function() {
        // my custom filter function
        return true;
    },
    
    pointToLayer (feature, layer) {
       if (feature.properties[todayString]){
        if (feature.properties[todayString]<1000){
        return L.circleMarker(layer, small_icon)
        }
        else if (feature.properties[todayString]>=1000 && feature.properties[todayString]<3000){
            return L.circleMarker(layer,medium_icon)
        }
        else if (feature.properties[todayString]>3000){
            return L.circleMarker(layer,large_icon)
        }
    } else {
        if (feature.properties[yesterdayString]<1000){
        return L.circleMarker(layer, small_icon)
        }
        else if (feature.properties[yesterdayString]>=1000 && feature.properties[yesterdayString]<3000){
            return L.circleMarker(layer,medium_icon)
        }
        else if (feature.properties[yesterdayString]>=3000){
            return L.circleMarker(layer,large_icon)
        }
    }

    },
    onEachFeature (feature, layer) {      
        
            if (feature.properties[todayString]){
            var content =  "<b>Country/Region:</b>"+feature.properties[country]+"<br>"+"<b>Province/State:</b>"+feature.properties["Province/State"]+"<br>"+ "<b>Confirmed Cases:</b>"+feature.properties[todayString]+"<br>"+ "<b>Data Date:</b>"+[todayString];
            layer.bindPopup(content,{closeButton: false, offset:L.point(0,-5) });
            var text = L.tooltip({
            permanent: true,
            direction: 'center',
            className: 'text'
            })
            .setContent(feature.properties[todayString])
            .setLatLng(layer.getLatLng());
            layer.bindTooltip(text)
          
            }
            else {
                var content =  "<b>Country/Region:</b>"+feature.properties[country]+"<br>"+"<b>Province/State:</b>"+feature.properties["Province/State"]+"<br>"+ "<b>Confirmed Cases:</b>"+feature.properties[yesterdayString]+"<br>"+ "<b>Data Date:</b>"+[yesterdayString];
            layer.bindPopup(content,{closeButton: false, offset:L.point(0,-5) });
            var text = L.tooltip({
            permanent: true,
            direction: 'center',
            className: 'text'
            })
            .setContent(feature.properties[yesterdayString])
            .setLatLng(layer.getLatLng());
            layer.bindTooltip(text)
           
            }

    
        },
        
});

var customLayer2 = L.geoJson(null, {
    filter: function() {
        // my custom filter function
        return true;
    },
    
    pointToLayer (feature, layer) {
       if (feature.properties[todayString]){
        if (feature.properties[todayString]<10){
        return L.circleMarker(layer, small_icon)
        }
        else if (feature.properties[todayString]>=10 && feature.properties[todayString]<100){
            return L.circleMarker(layer,medium_icon)
        }
        else if (feature.properties[todayString]>=100){
            return L.circleMarker(layer,large_icon)
        }
    } else {
        if (feature.properties[yesterdayString]<10){
        return L.circleMarker(layer, small_icon)
        }
        else if (feature.properties[yesterdayString]>=10 && feature.properties[yesterdayString]<100){
            return L.circleMarker(layer,medium_icon)
        }
        else if (feature.properties[yesterdayString]>=100){
            return L.circleMarker(layer,large_icon)
        }
    }
    },
    onEachFeature (feature, layer) {      
            if (feature.properties[todayString]){
            var content =  "<b>Country/Region:</b>"+feature.properties[country]+"<br>"+"<b>Province/State</b>:"+feature.properties["Province/State"]+"<br>"+ "<b>Deaths:</b>"+feature.properties[todayString]+"<br>"+ "<b>Data Date:</b>"+[todayString];
            layer.bindPopup(content,{closeButton: false, offset:L.point(0,-5) });
            var text = L.tooltip({
            permanent: true,
            direction: 'center',
            className: 'text'
            })
            .setContent(feature.properties[todayString])
            .setLatLng(layer.getLatLng());
            layer.bindTooltip(text)
            
            }
            else {
                var content =  "<b>Country/Region:</b>"+feature.properties[country]+"<br>"+"<b>Province/State</b>:"+feature.properties["Province/State"]+"<br>"+ "<b>Deaths:</b>"+feature.properties[yesterdayString]+"<br>"+ "<b>Data Date:</b>"+[yesterdayString];
            layer.bindPopup(content,{closeButton: false, offset:L.point(0,-5) });
            var text = L.tooltip({
            permanent: true,
            direction: 'center',
            className: 'text'
            })
            .setContent(feature.properties[yesterdayString])
            .setLatLng(layer.getLatLng());
            layer.bindTooltip(text)
            
            }
         
        },

        
});

var customLayer3 = L.geoJson(null, {
    filter: function() {
        // my custom filter function
        return true;
    },
    
    pointToLayer (feature, layer) {
       if (feature.properties[todayString]){
        if (feature.properties[todayString]<1000){
        return L.circleMarker(layer, small_icon_r)
        }
        else if (feature.properties[todayString]>=1000 && feature.properties[todayString]<2000){
            return L.circleMarker(layer,medium_icon_r)
        }
        else if (feature.properties[todayString]>=2000){
            return L.circleMarker(layer,large_icon_r)
        }
    } else {
        if (feature.properties[yesterdayString]<1000){
        return L.circleMarker(layer, small_icon_r)
        }
        else if (feature.properties[yesterdayString]>=1000 && feature.properties[yesterdayString]<2000){
            return L.circleMarker(layer,medium_icon_r)
        }
        else if (feature.properties[yesterdayString]>=2000){
            return L.circleMarker(layer,large_icon_r)
        }
    }
    },
    onEachFeature (feature, layer) {      
            if (feature.properties[todayString]){
            var content =  "<b>Country/Region:</b>"+feature.properties[country]+"<br>"+"<b>Province/State</b>:"+feature.properties["Province/State"]+"<br>"+ "<b>Recovered:</b>"+feature.properties[todayString]+"<br>"+ "<b>Data Date:</b>"+[todayString];
            layer.bindPopup(content,{closeButton: false, offset:L.point(0,-5) });
            var text = L.tooltip({
            permanent: true,
            direction: 'center',
            className: 'text'
            })
            .setContent(feature.properties[todayString])
            .setLatLng(layer.getLatLng());
            layer.bindTooltip(text)
            }
            else {
            var content =  "<b>Country/Region:</b>"+feature.properties[country]+"<br>"+"<b>Province/State</b>:"+feature.properties["Province/State"]+"<br>"+ "<b>Recovered:</b>"+feature.properties[yesterdayString]+"<br>"+ "<b>Data Date:</b>"+[yesterdayString];
            layer.bindPopup(content,{closeButton: false, offset:L.point(0,-5) });
            var text = L.tooltip({
            permanent: true,
            direction: 'center',
            className: 'text'
            })
            .setContent(feature.properties[yesterdayString])
            .setLatLng(layer.getLatLng());
            layer.bindTooltip(text)
           
        

            }
    }
            
        
});


var confirmed= omnivore.csv('https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Confirmed.csv',null,customLayer)
var deaths= omnivore.csv('https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Deaths.csv',null,customLayer2)
var recovered= omnivore.csv('https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Recovered.csv',null,customLayer3)

confirmed.addTo(map)

var baseLayers = {
           
		    
           };

         //grouping overlaying features
        var overlayElements = {
        "Coronavirus": {
          "Confirmed Cases": confirmed,
          "Deaths": deaths,
          "Recovered": recovered

    }
};

var options = {
  // Make the "Landmarks" group exclusive (use radio inputs)
  exclusiveGroups: ["Coronavirus"],
  // Show a checkbox next to non-exclusive group labels for toggling all
  groupCheckboxes: true,
  collapsed: false
};

L.control.groupedLayers(baseLayers, overlayElements, options).addTo(map);


</script> 
</body>
</html>